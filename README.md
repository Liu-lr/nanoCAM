# nanoCAM
We developed nanoCAM-seq(Nanopore Chromatin interaction, accessibility, DNA methylation sequeance), a strategy that capitalizes on M.CviPI enzyme labeling as well as the multi-way chromatin interactions capturing. Using NanoCAM-seq, we uncovered a dynamic coordination of chromatin features associated with A/B compartment transitions. Notably, promoters characterized by low DNA methylation and high chromatin accessibility—hallmarks of active, cell-type-specific gene expression—were preferentially engaged in multi-way enhancer interactions.

In this work, We use the human hg38 genome (GRCh38_no_alt_analysis_set_GCA_000001405.15) as reference, and public datasets of GM12878 and K562 cell lines were obtained from 4DN porter, ENDCODE or GEO database.
# software
python(3.8)
R(4.3.2)
Guppy(4.5.3)
falign()
nanopolish(0.11.1)
samtools(1.21)
Juicebox(2.13.07)
cooltools(0.4.1)
FAN-C(0.9.27)
deeptools(3.5.4)
# Basecalling and Methylation calling
In this step, Guppy and nanopolish software were used. And due to the large amount of Nanopore data, It is recommended to generate a corresponding FASTQ file for each multi-FAST5 file to improve processing efficiency. The input is fast5 file and the output is fastq and tsv files.
Conf_file="~/ont-guppy/data/dna_r9.4.1_450bps_hac_prom.cfg"

guppy_basecaller \
-i ${Fast5_file_dir} \
-s ${Exportdir} \
-c ${Conf_file}  \
-x cuda:0 \
-r -q 0 \
--min_qscore 7 \
--compress_fastq

nanopolish  index -d . run.fastq && \
samtools index run.bam && \
nanopolish call-methylation -q cpggpc -t 5 -r run.fastq -b run.bam -g GCA_000001405.15_GRCh38_major_chr.fa  > cpggpc_methylation_calls.tsv &&  
# Mapping
In this step, we used Falign software to mapping the reads to the hg38 reference genome.
falign -num_threads 80 -outfmt 'sam' -dump_by_file -out_dir ${Exportdir} ^GATC GCA_000001405.15_GRCh38_major_chr.fa ${fastqdir}
samtools sort samfile | samtools view -bS - > bamfile

# Generate pairwise contact matrix
To compare with the Hi-C data and the subsequent visualization, the multiway contacts of nanoCAM reads were decomposed into pairwise contacts using Genome_contact_frag_Result.py， and then mcool and hic format file were generated by cooler and Juicer tools, repectively.

cooler cload pairs -c1 2 -p1 3 -c2 4 -p2 5 $CHROMSIZES_FILE:$BINSIZE $PAIRS_FILE_Sort $COOL_FILE
cooler zoomify -n 40 -r 1000,2000,5000,10000,25000,50000,100000,250000,500000,1000000,2500000,5000000,10000000 --balance -o ${sname}.mcool $COOL_FILE 2>${sname}.log

# juice_matrix to hic
java -Xmx300g -Xms100g -jar ${juicertools} pre -j 40 --threads 40 ${PAIRS_FILE_Sort} ${sname}.hic ${CHROMSIZES_FILE}  &>${log}
